name: CI pull request

on:
  push: 
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop

jobs:
  build:

    #  runs-on: ubuntu-latest # need to use linux if we want to use the linter
    runs-on: macos-11
    timeout-minutes: 20
    environment: 
      name: AppCenter
      url: https://appcenter.ms/

    steps:
    - uses: actions/checkout@v2.3.4
    - name: Create service account
      run: ./gradlew clean assembleDebug assembleDebugAndroidTest 

    - name: Build APK files
      run: echo '${{ secrets.SERVICE_ACCOUNT }}' > service_account_created.json

    - name: flank run
      id: flank_run
      uses: Flank/flank@master
      with:
        # Service account created in previous step
        service_account: './service_account_created.json'
        # Run Android tests
        platform: android
        # Path to configuration file from local repo
        flank_configuration_file: './flank.yml'

    - name: output
      run: |
        # Use local directory output
        echo "Local directory: ${{ steps.flank_run.outputs.local_results_directory }}"
        # Use Gcloud storage output 
        echo "Gcloud: ${{ steps.flank_run.outputs.gcloud_results_directory }}"

